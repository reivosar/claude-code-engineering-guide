# デプロイメント戦略

## 概要

テスト完了後のアプリケーションを本番環境に安全にリリースするためのプロセスです。

## デプロイメント戦略

### 1. デプロイメント方式

```markdown
## デプロイメント方式の選択

### Blue-Green Deploy
- **メリット**: 瞬時切替、ロールバック容易
- **デメリット**: リソース2倍必要
- **適用場面**: 重要システム

### Rolling Deploy
- **メリット**: リソース効率的
- **デメリット**: 一時的な不整合
- **適用場面**: 一般的なWebアプリ

### Canary Deploy
- **メリット**: リスク最小化
- **デメリット**: 複雑な設定
- **適用場面**: 大規模システム
```

### 2. CI/CDパイプライン

```yaml
# GitHub Actions例
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Tests
        run: |
          npm ci
          npm run test
          npm run e2e

  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Security Scan
        run: |
          npm audit
          npx snyk test

  deploy:
    needs: [test, security-scan]
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Production
        run: |
          docker build -t app:latest .
          docker push registry.example.com/app:latest
          kubectl apply -f k8s/
```

### 3. 環境管理

```markdown
## 環境構成

### Development
- **目的**: 開発者個人環境
- **データ**: テストデータ
- **監視**: 最小限

### Staging
- **目的**: 本番同等テスト
- **データ**: 本番データのサブセット
- **監視**: 本番同等

### Production
- **目的**: エンドユーザー提供
- **データ**: 本番データ
- **監視**: 24時間監視
```

### 4. 監視・アラート

```yaml
# Prometheus + Grafana設定例
monitoring:
  metrics:
    - response_time
    - error_rate
    - throughput
    - cpu_usage
    - memory_usage
  
  alerts:
    - name: High Error Rate
      condition: error_rate > 5%
      action: slack_notification
    
    - name: Response Time Slow
      condition: response_time > 2s
      action: email_alert
```

### 5. 災害復旧

```markdown
## 災害復旧計画

### バックアップ戦略
- **データベース**: 毎日フルバックアップ
- **ファイル**: 増分バックアップ
- **設定**: Git管理

### RTO/RPO目標
- **RTO**: 4時間以内
- **RPO**: 1時間以内

### 復旧手順
1. 障害検知・報告
2. 影響範囲確認
3. 復旧作業実施
4. 動作確認
5. 事後分析
```

## Claude Codeでのデプロイメント支援

### デプロイ戦略の相談

```
「以下のシステムに最適なデプロイ戦略を提案してください。

システム特性:
- ECサイト
- 24時間運用
- ピーク時100倍トラフィック
- ダウンタイム許容度: 最小限

考慮要素:
- コスト効率
- 運用複雑さ
- リスク管理
- スケーラビリティ」
```

### CI/CDパイプライン設計

```
「GitHub Actionsを使用したCI/CDパイプラインを設計してください。

要件:
- Node.js + React アプリ
- AWS ECS デプロイ
- セキュリティスキャン必須
- 自動テスト必須
- Slack通知必要

段階:
1. ビルド・テスト
2. セキュリティチェック
3. ステージング環境デプロイ
4. 本番環境デプロイ」
```

### 監視設定の依頼

```
「本番環境の監視設定を提案してください。

監視対象:
- Webアプリケーション
- PostgreSQL データベース
- Redis キャッシュ

要件:
- SLA 99.9%
- 異常時即座通知
- パフォーマンス分析
- セキュリティ監視」
```

---
[← 04. テスト](../04.testing/01.testing-strategy.md) | [Claude Codeガイド →](../99.claude-guide/01.workflow.md)